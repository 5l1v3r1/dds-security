# To compile, type:
# 	gmake -f makefile_rti
#
# This makefile assumes that your build environment is already correctly
# configured. (For example, the correct version of your compiler and
# linker should be on your PATH.)
######################################################################

# If undefined in the environment default NDDSHOME to install dir
ifndef NDDSHOME
NDDSHOME := /local/preship/ndds/ndds.6.0.1/unlicensed/rti_connext_dds-6.0.1
endif

ifndef RTI_OPENSSLHOME
RTI_OPENSSLHOME := /local/preship/openssl/openssl-1.1.1d
endif

TARGET_ARCH = i86Linux3gcc4.8.2

COMPILER = g++
COMPILER_FLAGS = -ggdb -m32 -Wall
LINKER = g++
LINKER_FLAGS = -m32 -static-libgcc -Wl,--no-as-needed
SYSLIBS      = -ldl -lnsl -lm -lpthread -lrt
DEFINES      = 

INCLUDES = -I. 
MAIN    = ShapeType_main.cxx
SOURCES = $(MAIN)


#These are for RTI
RTISRCDIR = rti_connext_dds
SOURCES  += $(RTISRCDIR)/ShapeTypeSupport.cxx $(RTISRCDIR)/ShapeTypePlugin.cxx $(RTISRCDIR)/ShapeType.cxx 
LIBS     +=  -L$(NDDSHOME)/lib/$(TARGET_ARCH) \
             -lnddssecurityzd -lnddscppzd -lnddsczd -lnddscorezd \
             -L$(RTI_OPENSSLHOME)/$(TARGET_ARCH)/debug/lib \
             -lsslz -lcryptoz $(SYSLIBS)
DEFINES  += -DRTI_CONNEXT_DDS -DRTI_UNIX -DRTI_LINUX 
INCLUDES += -I$(NDDSHOME)/include -I$(NDDSHOME)/include/ndds 
#End of RTI
       

OBJS    = $(SOURCES:%.cxx=%.o)
EXEC    = rti_connext_dds_6.0.1_linux

RTIDDSGENCMD = $(shell \
	$(NDDSHOME)/bin/rtiddsgen \
	ShapeType.idl \
	-example $(TARGET_ARCH) \
	-language C++ \
	-d $(RTISRCDIR) \
	-replace))

all: $(EXEC)

$(EXEC) : $(RTISRCDIR) $(OBJS)
	$(LINKER) $(LINKER_FLAGS)  -o $@ $(OBJS) $(LIBS)

%.o : %.cxx 
	$(COMPILER) $(COMPILER_FLAGS)  -o $@ $(DEFINES) $(INCLUDES) -c $<

$(RTISRCDIR):
	@echo "RTI source directory does not exist. Creating one with rtiddsgen..."
	$(info $(shell mkdir $(RTISRCDIR)))
	$(info $(RTIDDSGENCMD))
